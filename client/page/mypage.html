<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>carryAll_마이페이지</title>
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/admin.css" />
    <link rel="stylesheet" href="../css/mypage.css" />
    <link rel="stylesheet" href="../css/mypageOrder.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
  </head>
  <body>
    <!-- 헤더 가져오기 -->
    <header id="header"></header>

    <!-- 컨텐츠 -->
    <main class="mypage">
      <section class="container">
        <h2>마이페이지</h2>
        <div class="profileWrap">
          <div class="profileImg"><img src="" alt="" /></div>
          <div class="profileTxt">
            <h4 class="nameId"><span class="localName">엘리스</span> 님</h4>
            <p class="nameDesc">
              <span class="localName">엘리스</span> 님의 아이디는
              <span class="localIdName">silver</span>입니다.<br />
            </p>
          </div>
          <div class="btnWrap">
            <a class="profileBtn" href="javascript:void(0);">회원정보 변경</a>
          </div>
        </div>

        <div class="contWrap">
          <!-- 왼쪽 nav menu -->
          <ul class="navCont">
            <li class="navTit n1">쇼핑정보</li>
            <li><a href="javascript:void(0);">주문/배송조회</a></li>
            <li><a href="javascript:void(0);">취소/반품/교환내역</a></li>
            <!-- <li><a href="javascript:void(0);">장바구니</a></li> -->
            <li class="navTit">혜택관리</li>
            <li>
              <a class="develop" href="javascript:void(0);">쿠폰(준비중)</a>
            </li>
            <li class="navTit">고객센터</li>
            <li>
              <a class="develop" href="javascript:void(0);">1:1 문의(준비중)</a>
            </li>
            <li class="navTit">회원정보</li>
            <li><a href="/loginChange">회원정보변경</a></li>
            <li><a href="/loginWithdraw">회원탈퇴</a></li>
            <li><a class="logout" href="/main">로그아웃</a></li>
            <li>
              <a class="develop" href="javascript:void(0);"
                >배송지관리(준비중)</a
              >
            </li>
          </ul>

          <!-- 오른쪽 해당 컨텐츠 -->
          <div class="mainCont">
            <div class="infoCont">
              <h3>배송 조회</h3>
              <ul class="shipBox">
                <li>
                  <h6 class="orderStatus orderStatus1">0</h6>
                  <p>결제완료</p>
                </li>
                <li>
                  <h6 class="orderStatus orderStatus2">0</h6>
                  <p>상품준비중</p>
                </li>
                <li>
                  <h6 class="orderStatus orderStatus3">0</h6>
                  <p>배송중</p>
                </li>
                <li>
                  <h6 class="orderStatus orderStatus4">0</h6>
                  <p>배송완료</p>
                </li>
              </ul>
              <ul class="shippedBox">
                <li>취소 내역 : <span>0</span></li>
                <li>교환 내역 : <span>0</span></li>
                <li>반품 내역 : <span>0</span></li>
              </ul>
            </div>

            <div class="infoCont">
              <h3>주문 조회</h3>
              <div class="orderList">
                <div class="listTop">
                  <div class="orderItem">
                    <div class="num">No.</div>
                    <div class="orderNum">
                      <span>주문번호</span>
                    </div>
                    <div class="total">주문금액</div>
                    <div class="date"><span>주문날짜</span></div>
                    <div class="status">배송상태</div>
                  </div>
                </div>
                <div class="listBody">
                  <p class="noPost">주문내역이 없습니다.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- 푸터 가져오기 -->
    <footer id="footer"></footer>

    <!-- 탑버튼 가져오기 -->
    <div class="top">top</div>

    <script src="../js/top.js"></script>
    <script src="../js/header.js"></script>
    <script src="../js/footer.js"></script>
    <!-- <script src="../js/admin.js"></script> -->
    <script>
      function userMypage() {
        axios
          .get("/api/mypage")
          .then((response) => {
            const userData = response.data;

            if (userData) {
              const localName = document.querySelectorAll(".localName");
              localName.forEach((name) => {
                name.innerHTML = userData.name;
              });
            }
            const localIdName = document.querySelector(".localIdName");
            localIdName.innerHTML = userData.username;

            userOrder(userData.username);
          })
          .catch((error) => {
            console.error("로그인 여부 확인 중 오류 발생:", error);
            window.location.href = "/";
          });
      }

      userMypage();

      function userOrder(username) {
        axios
          .get(`/api/orders/${username}`)
          .then((response) => {
            const orderData = response.data;

            let htmlString = "";

            const orderStatus = document.getElementsByClassName('orderStatus');
           
            orderData.forEach((order, index) => {

              const date = order.date;
              const sliceDate = date.slice(0, 10);

              const productList = order.productInformation;
              let total = 0;

              for(let i = 0; i < productList.length; i++) {
                total += productList[i].price;
              }

              htmlString += `
              <div class="orderItem">
                <div class="num">
                  ${index + 1}
                </div>
                <div class="orderNum">
                    <span>${order._id}</span>
                </div>
                <div class="total"><span>${total}</span></div>
                <div class="date"><span>${sliceDate}</span></div>
                <div class="status">${order.status}</div>
              </div>`;
              
            });


            const listBody = document.querySelector(".listBody");
            listBody.innerHTML = htmlString;
          })
          .catch((error) => {
            console.error("에러", error);
          });
      }

      // // 3. 고도화 기능 closing alert
      // const developLinks = document.querySelectorAll(".develop");
      // developLinks.forEach(function(link) {
      //   link.addEventListener("click", function(event) {
      //     event.preventDefault();
      //     alert("해당 기능은 준비중입니다.");
      //   });
      // });
    </script>
  </body>
</html>
